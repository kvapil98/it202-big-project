<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Big Project</title>
  <link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
      
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
      
      
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
      <script type="text/javascript" src="states.js"></script>
  <style>
    :root {
      --mdc-theme-primary: #3A0CA3;
    }

    body {margin: 0;}
    main {margin-left: 8px;}
    
    .view {display: none;}
      
      #countriesAdded {
          width:500px}  
      
      .demo-card {
          height: 500px;
          width: 350px;
        }
      
      .demo-card__primary-action{
          height: 500px;
      }
  </style>

  </head>
  <body>  
    

    <header class="mdc-top-app-bar">
      <div class="mdc-top-app-bar__row">
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
          <span class="mdc-top-app-bar__title">COVID-19</span>
        </section>
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
          <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button topBarButton" value="home" aria-label="Home">home</button>
          <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button topBarButton" value="one" aria-label="Search">search</button>
          <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button topBarButton" value="two" aria-label="Table">table_chart</button>
          <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button topBarButton" value="three" aria-label="Chart">location_on</button>
            <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button topBarButton" id="graphFour" value="four" aria-label="Chart">show_chart</button>
        </section>
      </div>
    </header>



    <main class="mdc-top-app-bar--fixed-adjust">


      <div class="" id="home">
         <h1>Welcome</h1>
         <p>Data source can be found at <a href="https://pomber.github.io/covid19/timeseries.json" target="_blank">https://pomber.github.io/covid19/timeseries.json</a></p>
     </div> 

     <div class="view" id="one">
         <h1>Select States</h1>
         <p>Find countries by typing and then add them to the list. Click chart once satisfied with the list</p>
         <input id="statesInput" list="states">

         <datalist id="states">
         </datalist>
         <button class="mdc-button foo-button mdc-button--raised">
             <div class="mdc-button__ripple"></div>
             <span class="mdc-button__label">Add</span>
         </button>

         <button class="mdc-button bar-button mdc-button--raised">
             <div class="mdc-button__ripple"></div>
             <span class="mdc-button__label">Get Info</span>
         </button>

         <ul class="mdc-list" id="countriesAdded">
        </ul>

     </div> 



     <div class="view" id="two">
         <h1>State Information</h1>
         <div id="state-container">
             
         </div>
<!--          <h3>Number of Deaths</h3>
         <div class="mdc-data-table">
          <table class="mdc-data-table__table" aria-label="Dessert calories">
            <thead>
              <tr class="mdc-data-table__header-row">
                <th class="mdc-data-table__header-cell">Date</th>
              </tr>
            </thead>
            <tbody class="mdc-data-table__content">
            </tbody>
          </table>
        </div> -->
     </div>


     <div class="view" id="three">
         <h1>Geolocation Information</h1>
         
         <div class="mdc-card demo-card demo-basic-with-header">
          <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0">
            <div class="mdc-card__media mdc-card__media--16-9 demo-card__media" style="background-image: url(&quot;https://www.alabamawx.com/wp-content/uploads/2017/03/shutterstock_240459751-600x400.jpg&quot;);">
              <div class="mdc-card__media-content demo-card__media-content">
                <div class="demo-card__primary">
                  <h1 class="demo-card__title mdc-typography mdc-typography--headline6" style="font-size: 26px;font-style: italic;">Current Weather</h1>
                  <h1 class="demo-card__subtitle mdc-typography mdc-typography--subtitle2" id="currTemp" style="font-size: xxx-large;"></h1>
                </div>
              </div>
            </div>
            <div class="demo-card__secondary mdc-typography mdc-typography--body2">
                <h1>Details</h1>
                <h3 id="currFeelsLike"></h3>
                <h3 id="currTempHigh"></h3>
                <h3 id="currTempLow"></h3>
                <h3 id="currHumidity"></h3>
                <h3 id="currWind"></h3>

            </div>
          </div>
        </div>
    
     </div>
        
        
     <div class="view" id="four">
         <h1>State Information</h1>
         <div id="state-container">
             
         </div>
          <div id="chart_div"></div>
<!--          <h3>Number of Deaths</h3>
         <div class="mdc-data-table">
          <table class="mdc-data-table__table" aria-label="Dessert calories">
            <thead>
              <tr class="mdc-data-table__header-row">
                <th class="mdc-data-table__header-cell">Date</th>
              </tr>
            </thead>
            <tbody class="mdc-data-table__content">
            </tbody>
          </table>
        </div> -->
      </div>
        
    </main>


    <script>
        
        
        
        //init material componenents
        mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));
        mdc.ripple.MDCRipple.attachTo(document.querySelector('.bar-button'));
        mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('header.mdc-top-app-bar'));
        //mdc.dataTable.MDCDataTable.attachTo(document.querySelector('.mdc-data-table'));  
        
        //grab some nodes that will be used later
        let statesInput = document.querySelector('#statesInput');
        let inputList = document.querySelector('#countriesAdded'); 
        let stateDataList = document.querySelector('#states');
        //let tableHeader = document.querySelector('.mdc-data-table__header-row');
        //let tableContent = document.querySelector('.mdc-data-table__content');
        let stateContain = document.querySelector('#state-container');
        let graphButton = document.querySelector('#graphFour');
        
        //weather DOM components
        let currTemp = document.querySelector('#currTemp');
        let currFeelsLike = document.querySelector('#currFeelsLike');
        let currTempHigh = document.querySelector('#currTempHigh');
        let currTempLow = document.querySelector('#currTempLow');
        let currHumidity = document.querySelector('#currHumidity');
        let currWind = document.querySelector('#currWind');
        
        
        //init global variables
        let statesArray = [];  
        let fetchedData = [];
        let clickedInfo = false;

        //add state abreviations to list choices
        statesAbr.forEach( (key) => {
            let listOption = document.createElement('option');
            listOption.value = ''+key;

            stateDataList.appendChild(listOption);                  
         });        
        

//         let url = "https://maps.googleapis.com/maps/api/geocode/json?latlng=42.1928236,-88.21689320000002&key=AIzaSyBGigYPYNDYIjMBPJowjOEAebOqmx-9aWM"
//           fetch(url)
//           .then(response => response.json())
//           .then(data => {
//             console.log(data);
//             //fetchedData = data;
//           });  
        
        //add the graph functionality to the graph icon
        graphButton.addEventListener('click', event => {
            let grData = new google.visualization.DataTable();
            let grVals = [];
            let check
            grData.addColumn('string', 'Date');
            
            let addColumn = true;
            for(let i=6; i>-1; i--){
                let temp = [];
                let checkCount = true;
                fetchedData.forEach((state) => {
                    if(statesArray.includes(state[0].state)){
                        if(addColumn){
                            grData.addColumn('number', state[0].state);
                        };
                        
                        if(checkCount){
                          let dateVal = state[i].dateChecked.split("T");
                          temp.push(dateVal[0]);  
                          checkCount = false;
                        };
                        temp.push(state[i].positive);
                    }
                });
                addColumn = false;
                console.log(temp);
                grVals.push(temp);
            }
            
            grData.addRows(grVals);
            drawBasic(grData);
        });
        
        
        //add countries to statesArray when add button is clicked  
        document.querySelector('.foo-button').addEventListener('click', event => {
            
            //first check if there is a value
            if(statesInput.value != ''){
                //make sure state is not already in array
                if(!statesArray.includes(statesInput.value)){

                    //create delete button
                    let delButton = document.createElement('button');
                    delButton.classList.add('mdc-button','bar-button','mdc-button--raised');
                    mdc.ripple.MDCRipple.attachTo(delButton);
                    let delButtonDiv = document.createElement('div');
                    delButtonDiv.classList.add('mdc-button__ripple');
                    delButton.appendChild(delButtonDiv);
                    let delButtonSpan = document.createElement('span');
                    delButtonSpan.classList.add('mdc-button__label');
                    delButtonSpan.textContent = "Delete";
                    delButton.appendChild(delButtonSpan);
                    
                    //create list item
                    let listItem = document.createElement('li');
                    listItem.classList.add('mdc-list-item');
                    listItem.style.justifyContent = "space-between";
                    mdc.ripple.MDCRipple.attachTo(listItem);
                    
                    //create text item
                    let textItem = document.createElement('span');
                    textItem.classList.add('mdc-list-item__text');
                    textItem.appendChild(document.createTextNode(statesInput.value));
                    
                    //add to list
                    listItem.appendChild(textItem);
                    listItem.appendChild(delButton);
                    inputList.appendChild(listItem);
                    
                    //add functionality to delete button
                    delButton.addEventListener("click", function(){
                        listItem.remove();
                        statesArray.splice(statesArray.indexOf(textItem.textContent),1);
                    });
                    
                    //keep track of states
                    statesArray.push(statesInput.value);
                }
            }
            
            //make input blank
            statesInput.value = '';
        });

        
        
        
        
        
        //functionality when chart button is clicked
        document.querySelector('.bar-button').addEventListener('click', event => {
            
            if(clickedInfo){
                document.querySelectorAll('.stateInfoCard').forEach((card) => {card.remove()});
            }
            fetchedData.length = 0;
            
            
            statesArray.forEach((state) => {
                let card = document.createElement('div');
                card.classList.add('mdc-card', 'demo-card', 'stateInfoCard');
           
                
                let abr = document.createElement('h1');
                abr.textContent = state;
                
                let overallTitle = document.createElement('h2');
                overallTitle.textContent = "Overall";
                
                let hospitalTitle = document.createElement('h2');
                hospitalTitle.textContent = "Hospitalized";
                
                let positive = document.createElement('h3');
                let negative = document.createElement('h3');
                let hosCurr = document.createElement('h3');
                let hosCum = document.createElement('h3');
                let url = "https://covidtracking.com/api/v1/states/" + state + "/daily.json"
                
                fetch(url)
                .then(response => response.json())
                .then(data => {
                    //console.log(data);
                    positive.textContent = "Confirmed Cases: " + data[0].positive;
                    negative.textContent = "Total Deaths: " + data[0].death;
                    hosCurr.textContent = "Currently: " + data[0].hospitalizedCurrently;
                    hosCum.textContent = "Cumulative: " + data[0].hospitalizedCumulative;
                    fetchedData.push(data);
                });
                
                card.appendChild(abr);
                card.appendChild(overallTitle);
                card.appendChild(positive);
                card.appendChild(negative);
                card.appendChild(hospitalTitle);
                card.appendChild(hosCurr);
                card.appendChild(hosCum);
                
                
                stateContain.appendChild(card);
                
                
            });
            
             hideViews();
             clickedInfo = true;
             document.querySelector('#two').style.display = "block";

        });


       



          //function to hide all views
          hideViews = () => {
             document.querySelectorAll('.view').forEach(item => {

                item.style.display="none";

            });
              document.querySelector('#home').style.display="none";
          }


          //add functionality to all topbar icons for views
          document.querySelectorAll('.topBarButton').forEach(item => {
               item.addEventListener('click', event => {

                 hideViews();
                 let val = item.value;
                 
                 //geolocation routine
                 if(val == "three"){
                     getGeolocationInfo();
                 }  
                   
                 document.querySelector("#"+val).style.display="block";
               })
          });

            
            let getGeolocationInfo = () => {
              console.log("correct");
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            }
            
          
            let showPosition = (position) => {
                console.log(position.coords.latitude + " " + position.coords.longitude);
                let weatherUrl = "https://api.openweathermap.org/data/2.5/weather?lat="+position.coords.latitude+"&lon=" +position.coords.longitude+"&units=imperial&appid=b2413ddb608f02bb63cf6e2a9c922b62";
                //let weatherUrl = "https://api.openweathermap.org/data/2.5/weather?lat=35&lon=139&appid=b2413ddb608f02bb63cf6e2a9c922b62";
                fetch(weatherUrl)
                  .then(response => response.json())
                  .then(data => {
                    //console.log(data);
                    currTemp.textContent = data.main.temp + String.fromCharCode(176); 
                    currFeelsLike.textContent = "Feels Like:  " + data.main["feels_like"] + String.fromCharCode(176);
                    currTempHigh.textContent = "Temp High: "+data.main["temp_max"] + String.fromCharCode(176);
                    currTempLow.textContent = "Temp Low: " + data.main["temp_min"] + String.fromCharCode(176);
                    currHumidity.textContent = "Humidity: "+data.main.humidity + "%";
                    currWind.textContent = "Wind Speed: "+data.wind.speed + "mph";
                    //fetchedData = data;
                  });  
                
            }
          
            
            
            
            
            google.charts.load('current', {
              packages: ['corechart', 'line']
            });
            //google.charts.setOnLoadCallback(drawBasic);

            let drawBasic = (addedData) => {

              var options = {
                hAxis: {
                  title: 'Time',
                  slantedText:true, 
                  slantedTextAngle:30,
                  format: 'M/d/yy',
                  gridlines: {count: 15}
                },
                vAxis: {
                  title: 'Popularity'
                },
                width: 900,
                height: 500
              };

              var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

              chart.draw(addedData, options);
            }
            
            
            
            
            
            
            
            
            
            
          //google chart
          google.charts.load('current', {'packages':['corechart']});
          
          //function to draw graph with given data
          let drawChart = (addedData) => {

            var data = google.visualization.arrayToDataTable(addedData);                  

            var options = {
              title: 'Total Number Deaths',
              width: 900,
              height: 500
            };

            var chart = new google.visualization.PieChart(document.getElementById('piechart'));

            chart.draw(data, options);
        }
    </script>
  </body>
</html>